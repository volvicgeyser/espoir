#include "StdAfx.h"
#include "Graphic.h"
#include "debug.h"

namespace espoir{

Graphic::Graphic(SPGraphicInfo gInfo)
{
	if(gInfo_.get() == NULL)
		this->gInfo_ = gInfo;

	//BackBufferSurface‚Ì‰Šú‰»
	if(this->gInfo_->backBuf == NULL){
		//const HRESULT hr = this->gInfo_->d3Device->GetBackBuffer(
	//		0, 0, D3DBACKBUFFER_TYPE_MONO, &this->gInfo_->backBuf);
		const HRESULT hr = this->gInfo_->d3Device->GetBackBuffer(
			0, 0,  D3DFMT_R5G6B5, &this->gInfo_->backBuf);
		if(FAILED(hr)){
			DOut dout;
			dout << _T("BackBuffer‚Ì‰Šú‰»‚ÉŽ¸”s‚µ‚Ü‚µ‚½ ") << _T("File: ")<<__FILE__ << _T(" Line: ")<<__LINE__ << std::endl;
		}
	}
}


void Graphic::DrawCircle(Rect rect)
{
	if(!this->gInfo_->d3Device) return;

	HDC hDC;
	const HRESULT hrClear = this->gInfo_->d3Device->Clear(0, NULL, D3DCLEAR_TARGET, D3DCOLOR_XRGB(100, 100, 50), 1.0f, 0);
	
	//³‚µ‚­‰æ–ÊƒNƒŠƒA‚³‚ê‚½‚©‚Ç‚¤‚©test
	EXPECT_HRESULT_SUCCEEDED(hrClear);

	if(this->gInfo_->backBuf != NULL){
		const HRESULT hr = this->gInfo_->backBuf->GetDC(&hDC);
		
		//³‚µ‚­•`‰æ‚³‚ê‚Ä‚¢‚é‚©‚Ç‚¤‚©test
		EXPECT_HRESULT_SUCCEEDED(hr);

		if(SUCCEEDED(hr)){
			Ellipse(hDC, rect.x, rect.y, rect.h, rect.w);
			this->gInfo_->backBuf->ReleaseDC(hDC);
		}
		else{
			DOut dout;
			dout << _T("Error: ") << hr << _T(" ‰~‚Ì•`‰æ‚ÉŽ¸”s‚µ‚Ü‚µ‚½ ") << _T("File: ")<<__FILE__ << _T(" Line: ")<<__LINE__ << std::endl;
			//Œ^ƒ`ƒFƒbƒNƒeƒXƒg
			typedef ::testing::Types<long> testTypes;
			TYPED_TEST_CASE(getdc_result_test, testTypes);

			switch(hr){
				case E_FAIL:
					dout << _T("E_FAIL");
					break;
				case D3DERR_INVALIDCALL :
					dout << _T("–³Œø‚ÈŒÄ‚Ño‚µ");
					break;
			}
		}

	}
	else{
		DOut dout;
		dout << _T("backBuf‚ª‰Šú‰»‚³‚ê‚Ä‚¢‚Ü‚¹‚ñ ") << __FILE__ << std::endl;
	}
}

Graphic::~Graphic(void)
{
}


}
